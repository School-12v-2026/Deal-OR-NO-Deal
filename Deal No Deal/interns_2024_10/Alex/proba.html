<!DOCTYPE html>
<html>

<head>
    <title>Deal or No Deal</title>
    <style>
        body {
            font-family: Arial, Helvetica, sans-serif;
        }

        * {
            box-sizing: border-box;
        }

        /* Set a style for all buttons */
        button {
            background-color: #04AA6D;
            color: white;
            padding: 14px 20px;
            margin: 8px 0;
            border: none;
            cursor: pointer;
            width: 100%;
            opacity: 0.9;
        }

        button:hover {
            opacity: 1;
        }

        /* Float cancel and delete buttons and add an equal width */
        .cancelbtn,
        .deletebtn {
            float: left;
            width: 50%;
        }

        /* Add a color to the cancel button */
        .cancelbtn {
            background-color: #ccc;
            color: black;
        }

        /* Add a color to the delete button */
        .deletebtn {
            background-color: #f44336;
        }

        /* Add padding and center-align text to the container */
        .container {
            padding: 16px;
            text-align: center;
        }

        /* The Modal (background) */
        .modal {
            display: none;
            /* Hidden by default */
            position: fixed;
            /* Stay in place */
            z-index: 1;
            /* Sit on top */
            left: 0;
            top: 0;
            width: 100%;
            /* Full width */
            height: 100%;
            /* Full height */
            overflow: auto;
            /* Enable scroll if needed */
            background-color: #474e5d;
            padding-top: 50px;
        }

        /* Modal Content/Box */
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto 15% auto;
            /* 5% from the top, 15% from the bottom and centered */
            border: 1px solid #888;
            width: 80%;
            /* Could be more or less, depending on screen size */
        }

        /* Style the horizontal ruler */
        hr {
            border: 1px solid #f1f1f1;
            margin-bottom: 25px;
        }

        /* The Modal Close Button (x) */
        .close {
            position: absolute;
            right: 35px;
            top: 15px;
            font-size: 40px;
            font-weight: bold;
            color: #f1f1f1;
        }

        .close:hover,
        .close:focus {
            color: #f44336;
            cursor: pointer;
        }

        /* Clear floats */
        .clearfix::after {
            content: "";
            clear: both;
            display: table;
        }

        /* Change styles for cancel button and delete button on extra small screens */
        @media screen and (max-width: 300px) {

            .cancelbtn,
            .deletebtn {
                width: 100%;
            }
        }



        #boxes div {
            display: inline-block;
            width: 50px;
            height: 50px;
            background: lightgrey;
            margin: 5px;
            text-align: center;
            line-height: 50px;
            cursor: pointer;
            border: 1px solid black;
        }

        #prices li {
            list-style: none;
        }
    </style>
</head>

<body>

    <div id="boxes"></div>
    <ul id="prices"></ul>
    <div id="offer"></div>
    <div id="status"></div>
    <div id="boxesToOpen">Boxes to open this round: 0</div>
    <script>
        document.addEventListener("DOMContentLoaded", (event) => {
            loadBoxes();
            console.log("DOM fully loaded and parsed");
            loadPrices();
            boxesToNextOffer = getNextOfferInterval();
            updateBoxesToOpen();
        });

        let boxes = [];
        const numberBoxes = 26;
        let userBox = null;
        const dealOrNoDealPrizes = [
            0.01, 1, 5, 10, 25, 50, 75, 100, 200, 300, 400, 500,
            750, 1000, 5000, 10000, 25000, 50000, 75000, 100000,
            200000, 300000, 400000, 500000, 750000, 1000000
        ];
        let boxesOpened = 0;
        let boxesToNextOffer = 26;
        let round = 1;

        function loadBoxes() {
            let boxesCont = document.getElementById("boxes");
            boxes = [...dealOrNoDealPrizes];
            shuffleArray(boxes);
            for (let i = 0; i < numberBoxes; i++) {
                let box = document.createElement("div");
                box.id = i;
                box.addEventListener("click", () => clickBox(i));
                box.innerText = i + 1;
                boxesCont.appendChild(box);
            }
        }

        function loadPrices() {
            let pricesCont = document.getElementById("prices");
            for (let i = 0; i < numberBoxes; i++) {
                let price = document.createElement("li");
                price.innerText = dealOrNoDealPrizes[i];
                pricesCont.appendChild(price);
            }
        }

        function clickBox(i) {
            let box = document.getElementById(i);
            if (box.style.background === "yellow" || box.style.color === "green") {
                alert("You can't choose an opened case!");
                return;
            }
            if (userBox == null) {
                userBox = i;
                box.style.pointerEvents = "none";
                box.style.background = "yellow";
            } else {
                box.innerText = boxes[i];
                box.style.color = "green";
                let pricesCont = document.getElementById("prices");
                pricesCont.childNodes.forEach(element => {
                    if (element.innerText == boxes[i]) {
                        element.style.color = "red";
                    }
                });
                boxesOpened++;
                boxesToNextOffer--;
                updateBoxesToOpen();
                if (boxesToNextOffer == 0 && boxesOpened < 24) {
                    disableAllBoxes();
                    let offerAmount = offer();
                    showOffer(offerAmount);
                } else if (boxesOpened == 24) {
                    disableAllBoxes();
                    showLastOffer();
                }
            }
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function offer() {
            let pricesCont = document.getElementById("prices");
            let sum = 0;
            let count = 0;
            pricesCont.childNodes.forEach(element => {
                if (element.style.color !== "red") {
                    sum += Number(element.innerText);
                    count++;
                }
            });

            return Math.floor(sum / count * 0.75);
        }

        function swapCase() {
            if (userBox != null) {
                let box = document.getElementById(userBox);
                box.style.background = "white";
                box.style.pointerEvents = "auto";
                userBox = null;
                alert("Case swapped!");
            } else {
                alert("You must choose a case first!");
            }
        }

        function getNextOfferInterval() {
            if (boxesOpened < 6) return 6;
            if (boxesOpened < 11) return 5;
            if (boxesOpened < 15) return 4;
            if (boxesOpened < 18) return 3;
            if (boxesOpened < 20) return 2;
            return 1;
        }

        function showOffer(amount) {
            let offerDiv = document.getElementById("offer");
            offerDiv.innerHTML = `<p>The Banker's Offer: $${amount}</p><button id="dealButton">Deal</button><button id="noDealButton">No Deal</button>`;
            document.getElementById("dealButton").addEventListener("click", () => endGame(amount));
            document.getElementById("noDealButton").addEventListener("click", continueGame);
        }

        function showLastOffer() {
            let offerDiv = document.getElementById("offer");
            offerDiv.innerHTML = `<p>Would you like to swap your case?</p><button id="swapButton">Swap Case</button><button id="keepButton">Keep Case</button>`;
            document.getElementById("swapButton").addEventListener("click", swapCaseFinal);
            document.getElementById("keepButton").addEventListener("click", endGameFinal);
        }

        function swapCaseFinal() {
            let newUserBox;
            for (let i = 0; i < numberBoxes; i++) {
                if (i !== userBox && document.getElementById(i).style.color !== "green") {
                    newUserBox = i;
                    break;
                }
            }
            if (newUserBox != null) {
                let oldBox = document.getElementById(userBox);
                oldBox.style.background = "lightgrey";
                oldBox.style.pointerEvents = "auto";

                userBox = newUserBox;
                let newBox = document.getElementById(userBox);
                newBox.style.background = "yellow";
                newBox.style.pointerEvents = "none";

                alert("Case swapped!");
            }
            revealFinalCases();
        }

        function endGameFinal() {
            revealFinalCases();
        }

        function revealFinalCases() {
            let statusDiv = document.getElementById("status");
            let finalAmount = boxes[userBox];
            let otherBox;
            for (let i = 0; i < numberBoxes; i++) {
                if (i !== userBox && document.getElementById(i).style.color !== "green") {
                    otherBox = i;
                    break;
                }
            }
            let otherBoxAmount = boxes[otherBox];

            statusDiv.innerText = `Game over! In your box was $${finalAmount}. In the other box was $${otherBoxAmount}.`;

            let userBoxElement = document.getElementById(userBox);
            userBoxElement.innerText = finalAmount;

            let otherBoxElement = document.getElementById(otherBox);
            otherBoxElement.innerText = otherBoxAmount;
            otherBoxElement.style.color = "green";

            let offerDiv = document.getElementById("offer");
            offerDiv.innerHTML = '';
            disableAllBoxes();
        }

        function endGame(amount) {
            let statusDiv = document.getElementById("status");
            statusDiv.innerText = `You accepted the offer of $${amount}. Game over! In your box was $${boxes[userBox]}.`;
            let box = document.getElementById(userBox);
            box.innerText = boxes[userBox];
            let offerDiv = document.getElementById("offer");
            offerDiv.innerHTML = '';
            disableAllBoxes();
        }

        function continueGame() {
            let offerDiv = document.getElementById("offer");
            offerDiv.innerHTML = '';
            boxesToNextOffer = getNextOfferInterval();
            updateBoxesToOpen();
            enableAllBoxes();
        }

        function disableAllBoxes() {
            let boxes = document.getElementById("boxes").children;
            for (let box of boxes) {
                box.style.pointerEvents = "none";
            }
        }

        function enableAllBoxes() {
            let boxes = document.getElementById("boxes").children;
            for (let box of boxes) {
                if (box.style.background !== "yellow" && box.style.color !== "green") {
                    box.style.pointerEvents = "auto";
                }
            }
        }

        function updateBoxesToOpen() {
            let boxesToOpenDiv = document.getElementById("boxesToOpen");
            boxesToOpenDiv.innerText = `Boxes to open this round: ${boxesToNextOffer}`;
        }
    </script>
</body>

</html>