<!DOCTYPE html>
<html>

<head>
    <title>Deal or No Deal</title>
    <style>
        #boxes div {
            display: inline-block;
            width: 50px;
            height: 50px;
            background: lightgrey;
            margin: 5px;
            text-align: center;
            line-height: 50px;
            cursor: pointer;
            border: 1px solid black;
        }

        #prices li {
            list-style: none;
        }
    </style>
</head>

<body>

    <div id="boxes"></div>
    <div id="prices"></div>
    <div id="swapCase"></div>
    <div id="offer"></div>
    <div id="status"></div>
    <script>
        document.addEventListener("DOMContentLoaded", (event) => {
            loadBoxes();
            console.log("DOM fully loaded and parsed");
            loadPrices();

            boxesToNextOffer = getNextOfferInterval();
        });

        let boxes = [];
        const numberBoxes = 26;
        let userBox = null;
        const dealOrNoDealPrizes = [
            0.01, 1, 5, 10, 25, 50, 75, 100, 200, 300, 400, 500,
            750, 1000, 5000, 10000, 25000, 50000, 75000, 100000,
            200000, 300000, 400000, 500000, 750000, 1000000
        ];
        let boxesOpened = 0;
        let boxesToNextOffer = 26;
        let round = 1;

        function loadBoxes() {
            let boxesCont = document.getElementById("boxes");
            boxes = [...dealOrNoDealPrizes];
            shuffleArray(boxes);
            for (let i = 0; i < numberBoxes; i++) {
                let box = document.createElement("div");
                box.id = i;
                box.addEventListener("click", () => clickBox(i));
                box.innerText = i + 1;
                boxesCont.appendChild(box);
            }
        }

        function loadPrices() {
            let pricesCont = document.getElementById("prices");
            for (let i = 0; i < numberBoxes; i++) {
                let price = document.createElement("li");
                price.innerText = dealOrNoDealPrizes[i];
                pricesCont.appendChild(price);
            }
        }

        function clickBox(i) {
            let box = document.getElementById(i);
            if (box.style.background === "yellow" || box.style.color === "green") {
                alert("You can't choose an opened case!");
                return;
            }
            if (userBox == null) {
                userBox = i;
                box.style.pointerEvents = "none";
                box.style.background = "yellow";
            } else {
                box.innerText = boxes[i];
                box.style.color = "green";
                let pricesCont = document.getElementById("prices");
                pricesCont.childNodes.forEach(element => {
                    if (element.innerText == boxes[i]) {
                        element.style.color = "red";
                        box.style.color = "green";
                    }
                });
                boxesOpened++;
                boxesToNextOffer--;
                if (boxesToNextOffer == 0) {
                    let offerAmount = offer();
                    showOffer(offerAmount);
                    boxesToNextOffer = getNextOfferInterval();
                    round++;
                }
            }
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function offer() {
            let pricesCont = document.getElementById("prices");
            let sum = 0;
            let br = 0;
            pricesCont.childNodes.forEach(element => {
                if (element.style.color !== "red") {
                    sum += Number(element.innerText);
                    br++;
                }
            });

            return Math.floor(sum / br * 0.75);
        }

        function swapCase() {
            if (userBox != null) {
                let box = document.getElementById(userBox);
                box.style.background = "white";
                box.style.pointerEvents = "auto";
                userBox = null;
                alert("Case swapped!");
            } else {
                alert("You must choose a case first!");
            }
        }

        function getNextOfferInterval() {
            if (boxesOpened < 6) return 6;
            if (boxesOpened < 11) return 5;
            if (boxesOpened < 15) return 4;
            if (boxesOpened < 18) return 3;
            if (boxesOpened < 20) return 2;
            return 1;
        }

        function showOffer(amount) {
            if (boxesOpened == 24) {

                const swapButton = document.getElementById("swapButton");
                swapButton.addEventListener("click", swapCase);
                offerDiv.innerHTML = `<p>The Banker's Offer: <div id="swapCase"><button id="swapButton">Swap Case</button></div> const swapButton = document.getElementById("swapButton");
            swapButton.addEventListener("click", swapCase)</p><button id="dealButton">Deal</button><button id="noDealButton">No Deal</button>`;
                document.getElementById("dealButton").addEventListener("click", () => endGame(amount));
                document.getElementById("noDealButton").addEventListener("click", () => continueGame());
            }
            else {
                let offerDiv = document.getElementById("offer");
                offerDiv.innerHTML = `<p>The Banker's Offer: $${amount}</p><button id="dealButton">Deal</button><button id="noDealButton">No Deal</button>`;
                document.getElementById("dealButton").addEventListener("click", () => endGame(amount));
                document.getElementById("noDealButton").addEventListener("click", () => continueGame());
            }
        }

        function endGame(amount) {
            let statusDiv = document.getElementById("status");
            statusDiv.innerText = `You accepted the offer of $${amount}. Game over!`;
            let statusmyBox = document.getElementById(userBox);
            statusmyBox.innerText = boxes[userBox];
            statusDiv.innerText = `In your box were ` + boxes[userBox];
            let offerDiv = document.getElementById("offer");
            offerDiv.innerHTML = '';
            disableAllBoxes();

        }

        function continueGame() {
            let offerDiv = document.getElementById("offer");
            offerDiv.innerHTML = '';
        }

        function disableAllBoxes() {
            let boxes = document.getElementById("boxes").children;
            for (let box of boxes) {
                box.style.pointerEvents = "none";
            }
        }

    </script>
</body>

</html>